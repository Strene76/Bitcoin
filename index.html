<!DOCTYPE html>
<html lang="fr">
<!-- [Le head reste identique] -->

<body>
    <div class="container">
        <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ“</button>
        
        <div class="price-card">
            <div class="current-price">Chargement...</div>
            <div class="price-change">...</div>
        </div>

        <div class="time-filters">
            <button class="time-filter active" onclick="updateTimeframe('1d')">1J</button>
            <button class="time-filter" onclick="updateTimeframe('1w')">1S</button>
            <button class="time-filter" onclick="updateTimeframe('1M')">1M</button>
            <button class="time-filter" onclick="updateTimeframe('6M')">6M</button>
            <button class="time-filter" onclick="updateTimeframe('1y')">1A</button>
            <button class="time-filter" onclick="updateTimeframe('5y')">5A</button>
            <button class="time-filter" onclick="updateTimeframe('ALL')">Max</button>
        </div>

        <div class="chart-container">
            <canvas id="bitcoinChart"></canvas>
        </div>
    </div>

    <script>
        let chart;
        let currentTimeframe = '1d';

        // Configuration des intervalles pour chaque pÃ©riode
        const timeframeConfig = {
            '1d': { interval: '1m', limit: 1440 },    // 1 minute sur 24h
            '1w': { interval: '15m', limit: 672 },    // 15 minutes sur 1 semaine
            '1M': { interval: '1h', limit: 720 },     // 1 heure sur 1 mois
            '6M': { interval: '4h', limit: 1080 },    // 4 heures sur 6 mois
            '1y': { interval: '1d', limit: 365 },     // 1 jour sur 1 an
            '5y': { interval: '1w', limit: 260 },     // 1 semaine sur 5 ans
            'ALL': { interval: '1M', limit: 1000 }    // 1 mois depuis le dÃ©but
        };

        function formatDate(date, timeframe) {
            const options = {
                '1d': { hour: '2-digit', minute: '2-digit' },
                '1w': { weekday: 'short', hour: '2-digit' },
                '1M': { day: '2-digit', month: 'short' },
                '6M': { day: '2-digit', month: 'short' },
                '1y': { month: 'short', year: '2-digit' },
                '5y': { month: 'short', year: 'numeric' },
                'ALL': { month: 'short', year: 'numeric' }
            };
            return new Date(date).toLocaleDateString('fr-FR', options[timeframe]);
        }

        function initChart() {
            const ctx = document.getElementById('bitcoinChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Prix Bitcoin (EUR)',
                        data: [],
                        borderColor: '#1e88e5',
                        tension: 0.4,
                        pointRadius: 1,
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'â‚¬' + context.parsed.y.toLocaleString('fr-FR', {
                                        minimumFractionDigits: 2,
                                        maximumFractionDigits: 2
                                    });
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: true,
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        y: {
                            grid: {
                                display: true,
                                color: 'rgba(0,0,0,0.1)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return 'â‚¬' + value.toLocaleString('fr-FR');
                                }
                            }
                        }
                    }
                }
            });
        }

        async function updateChartData(timeframe) {
            try {
                const config = timeframeConfig[timeframe];
                const response = await fetch(
                    `https://api.binance.com/api/v3/klines?symbol=BTCEUR&interval=${config.interval}&limit=${config.limit}`
                );
                const data = await response.json();

                const prices = data.map(item => ({
                    time: item[0],
                    price: parseFloat(item[4])
                }));

                chart.data.labels = prices.map(item => formatDate(item.time, timeframe));
                chart.data.datasets[0].data = prices.map(item => item.price);
                
                // Mise Ã  jour du titre du graphique
                chart.options.plugins.title = {
                    display: true,
                    text: `Prix du Bitcoin - ${getTimeframeLabel(timeframe)}`
                };
                
                chart.update();

                // Mise Ã  jour du prix actuel
                const currentPrice = prices[prices.length - 1].price;
                const previousPrice = prices[prices.length - 2].price;
                const priceChange = ((currentPrice - previousPrice) / previousPrice) * 100;

                document.querySelector('.current-price').textContent = 
                    'â‚¬' + currentPrice.toLocaleString('fr-FR', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });

                const priceChangeElement = document.querySelector('.price-change');
                priceChangeElement.textContent = `${priceChange >= 0 ? '+' : ''}${priceChange.toFixed(2)}% (24h)`;
                priceChangeElement.className = `price-change ${priceChange >= 0 ? 'positive' : 'negative'}`;

            } catch (error) {
                console.error('Erreur lors de la rÃ©cupÃ©ration des donnÃ©es:', error);
            }
        }

        function getTimeframeLabel(timeframe) {
            const labels = {
                '1d': 'DerniÃ¨res 24 heures',
                '1w': 'DerniÃ¨re semaine',
                '1M': 'Dernier mois',
                '6M': '6 derniers mois',
                '1y': 'DerniÃ¨re annÃ©e',
                '5y': '5 derniÃ¨res annÃ©es',
                'ALL': 'Historique complet'
            };
            return labels[timeframe];
        }

        function toggleTheme() {
            document.body.setAttribute('data-theme', 
                document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'
            );
            updateChartTheme();
        }

        function updateChartTheme() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            chart.options.scales.x.grid.color = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
            chart.options.scales.y.grid.color = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
            chart.update();
        }

        function updateTimeframe(timeframe) {
            document.querySelectorAll('.time-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            currentTimeframe = timeframe;
            updateChartData(timeframe);
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            initChart();
            updateChartData('1d');
            
            // Mise Ã  jour automatique toutes les 30 secondes
            setInterval(() => {
                updateChartData(currentTimeframe);
            }, 30000);
        });
    </script>
</body>
</html>
