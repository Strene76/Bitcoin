<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment"></script>
    <style>
        /* [Styles pr√©c√©dents identiques] */
    </style>
</head>
<body>
    <div class="container">
        <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
        
        <div class="price-card">
            <div class="current-price">Chargement...</div>
            <div class="price-change">...</div>
        </div>

        <div class="time-filters">
            <button class="time-filter active" onclick="updateTimeframe(1)">1J</button>
            <button class="time-filter" onclick="updateTimeframe(7)">1S</button>
            <button class="time-filter" onclick="updateTimeframe(30)">1M</button>
            <button class="time-filter" onclick="updateTimeframe(180)">6M</button>
            <button class="time-filter" onclick="updateTimeframe(365)">1A</button>
            <button class="time-filter" onclick="updateTimeframe(1825)">5A</button>
            <button class="time-filter" onclick="updateTimeframe('max')">Max</button>
        </div>

        <div class="chart-container">
            <canvas id="bitcoinChart"></canvas>
        </div>
    </div>

    <script>
        let chart;

        async function fetchBitcoinData(days) {
            try {
                const response = await fetch(
                    `https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=eur&days=${days}&interval=${days === 1 ? 'hourly' : 'daily'}`
                );
                const data = await response.json();
                return data.prices;
            } catch (error) {
                console.error('Erreur lors de la r√©cup√©ration des donn√©es:', error);
                return [];
            }
        }

        function initChart() {
            const ctx = document.getElementById('bitcoinChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Prix Bitcoin (EUR)',
                        data: [],
                        borderColor: '#1e88e5',
                        tension: 0.4,
                        pointRadius: 1,
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '‚Ç¨' + context.parsed.y.toLocaleString('fr-FR', {
                                        minimumFractionDigits: 2,
                                        maximumFractionDigits: 2
                                    });
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day'
                            }
                        },
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return '‚Ç¨' + value.toLocaleString('fr-FR');
                                }
                            }
                        }
                    }
                }
            });
        }

        async function updateTimeframe(days) {
            document.querySelectorAll('.time-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const prices = await fetchBitcoinData(days);
            if (prices.length > 0) {
                const chartData = prices.map(price => ({
                    x: new Date(price[0]),
                    y: price[1]
                }));

                chart.data.datasets[0].data = chartData;
                
                // Ajuster l'unit√© de temps selon la p√©riode
                if (days === 1) {
                    chart.options.scales.x.time.unit = 'hour';
                } else if (days <= 7) {
                    chart.options.scales.x.time.unit = 'day';
                } else if (days <= 30) {
                    chart.options.scales.x.time.unit = 'day';
                } else if (days <= 365) {
                    chart.options.scales.x.time.unit = 'month';
                } else {
                    chart.options.scales.x.time.unit = 'year';
                }

                chart.update();

                // Mise √† jour du prix actuel
                const currentPrice = prices[prices.length - 1][1];
                const previousPrice = prices[prices.length - 2][1];
                const priceChange = ((currentPrice - previousPrice) / previousPrice) * 100;

                document.querySelector('.current-price').textContent = 
                    '‚Ç¨' + currentPrice.toLocaleString('fr-FR', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });

                const priceChangeElement = document.querySelector('.price-change');
                priceChangeElement.textContent = `${priceChange >= 0 ? '+' : ''}${priceChange.toFixed(2)}% (24h)`;
                priceChangeElement.className = `price-change ${priceChange >= 0 ? 'positive' : 'negative'}`;
            }
        }

        function toggleTheme() {
            document.body.setAttribute('data-theme', 
                document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'
            );
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            initChart();
            updateTimeframe(1);
            
            // Mise √† jour automatique toutes les 5 minutes
            setInterval(() => {
                const activeButton = document.querySelector('.time-filter.active');
                const days = activeButton.getAttribute('data-days');
                updateTimeframe(days);
            }, 300000);
        });
    </script>
</body>
</html>
